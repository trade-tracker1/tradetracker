<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeTracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: white;
            --border-color: #e2e8f0;
            --header-bg: #ffffff;
            --primary-color: #3b82f6;
            --profit-color: #10b981;
            --loss-color: #ef4444;
            --neutral-color: #64748b;
            --prev-month-color: #94a3b8;
        }
        
        .dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --border-color: #334155;
            --header-bg: #1e293b;
            --primary-color: #60a5fa;
            --profit-color: #34d399;
            --loss-color: #f87171;
            --neutral-color: #94a3b8;
            --prev-month-color: #475569;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }
        
        .main-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-section i {
            font-size: 28px;
            color: var(--primary-color);
        }
        
        .logo-section h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .welcome-section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .welcome-section p {
            color: var(--neutral-color);
            font-size: 14px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--neutral-color);
            font-size: 14px;
            font-weight: 500;
        }
        
        .positive-stat {
            color: var(--profit-color);
        }
        
        .negative-stat {
            color: var(--loss-color);
        }
        
        .neutral-stat {
            color: var(--primary-color);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .calendar-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .month-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .month-nav button {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: var(--neutral-color);
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .month-nav button:hover {
            background-color: var(--border-color);
        }
        
        .month-year {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            min-width: 140px;
            text-align: center;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .day-header {
            text-align: center;
            padding: 10px 5px;
            font-weight: 600;
            color: var(--neutral-color);
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .day {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 10px 8px;
            min-height: 80px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .day:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
            font-size: 14px;
            line-height: 1.2;
        }
        
        .prev-month-day {
            color: var(--prev-month-color);
            opacity: 0.5;
        }
        
        .profit {
            color: var(--profit-color);
            font-weight: 600;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .loss {
            color: var(--loss-color);
            font-weight: 600;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .trade-count {
            font-size: 10px;
            color: var(--neutral-color);
            margin-top: 3px;
            line-height: 1.2;
        }
        
        .recent-trades {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            height: fit-content;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .view-all {
            color: var(--primary-color);
            font-size: 14px;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        
        .trade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .trade-item:last-child {
            border-bottom: none;
        }
        
        .trade-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .trade-pair {
            font-weight: 600;
            color: var(--text-color);
            font-size: 14px;
        }
        
        .trade-date {
            color: var(--neutral-color);
            font-size: 12px;
        }
        
        .trade-profit {
            font-weight: 600;
            font-size: 14px;
        }
        
        .trade-profit.positive {
            color: var(--profit-color);
        }
        
        .trade-profit.negative {
            color: var(--loss-color);
        }
        
        .monthly-summary {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            margin-bottom: 25px;
        }
        
        .monthly-summary h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .summary-stat {
            text-align: center;
            padding: 15px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .summary-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            color: var(--neutral-color);
            font-size: 12px;
            font-weight: 500;
        }
        
        .chart-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            margin-bottom: 25px;
        }
        
        .chart-title {
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 18px;
            font-weight: 600;
        }
        
        .chart-wrapper {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: var(--border-color);
            color: var(--text-color);
        }
        
        .btn-danger {
            background-color: var(--loss-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--profit-color);
            color: white;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--neutral-color);
            cursor: pointer;
            font-size: 18px;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-btn:hover {
            background-color: var(--border-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h2 {
            font-size: 20px;
            color: var(--text-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--neutral-color);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .close-modal:hover {
            background-color: var(--border-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--neutral-color);
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--card-bg);
            color: var(--text-color);
            -webkit-appearance: none;
        }
        
        /* Fix for mobile negative number input */
        .form-group input[type="number"] {
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Settings Styles */
        .settings-section {
            margin-bottom: 25px;
        }
        
        .settings-section h3 {
            margin-bottom: 15px;
            font-size: 16px;
            color: var(--text-color);
        }
        
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .theme-toggle label {
            font-weight: 500;
            color: var(--text-color);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .file-input {
            display: none;
        }
        
        .file-input-label {
            display: block;
            padding: 12px 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .file-input-label:hover {
            background-color: #2563eb;
        }
        
        .export-btn {
            background-color: var(--profit-color);
            color: white;
            margin-top: 10px;
            width: 100%;
        }
        
        .export-btn:hover {
            background-color: #0da271;
        }
        
        /* All Trades Modal */
        .all-trades-modal .modal-content {
            max-width: 800px;
        }
        
        .trades-list {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .trade-management-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .trade-management-item:last-child {
            border-bottom: none;
        }
        
        .trade-management-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .trade-management-pair {
            font-weight: 600;
            color: var(--text-color);
            min-width: 100px;
        }
        
        .trade-management-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .trade-management-type.buy {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .trade-management-type.sell {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .trade-management-date {
            color: var(--neutral-color);
            font-size: 12px;
            min-width: 120px;
        }
        
        .trade-management-amount {
            color: var(--neutral-color);
            font-size: 14px;
        }
        
        .trade-management-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 6px 10px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit-btn {
            color: var(--primary-color);
            background-color: var(--border-color);
        }
        
        .delete-btn {
            color: var(--loss-color);
            background-color: var(--border-color);
        }
        
        /* Day Summary Styles */
        .day-summary {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }
        
        .day-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .day-summary-header h2 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .day-summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .day-summary-stat {
            text-align: center;
            padding: 15px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .day-summary-value {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .day-summary-label {
            color: var(--neutral-color);
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Bulk Selection Styles */
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .bulk-actions .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .select-all-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }
        
        .select-all-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .selected-count {
            font-size: 14px;
            color: var(--neutral-color);
        }
        
        .trade-management-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-actions {
                align-self: flex-end;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .trade-management-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .trade-management-actions {
                align-self: flex-end;
            }
            
            .bulk-actions {
                flex-direction: column;
            }
            
            .bulk-actions .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .calendar {
                gap: 4px;
            }
            
            .day {
                min-height: 70px;
                padding: 8px 6px;
            }
            
            .day-header {
                padding: 8px 4px;
                font-size: 11px;
            }
            
            .day-number {
                font-size: 12px;
            }
            
            .profit, .loss {
                font-size: 10px;
            }
            
            .month-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .today-btn {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="logo-section">
                <i class="fas fa-chart-line"></i>
                <h1>TradeTracker</h1>
            </div>
            <div class="welcome-section">
                <h2>Welcome, Trader</h2>
                <p>Here's your trading overview for today</p>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="settings-btn" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn btn-primary" id="add-trade-btn">
                    <i class="fas fa-plus"></i> Add Trade
                </button>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-value positive-stat" id="total-profit">+$0.00</div>
                <div class="stat-label">P&L</div>
            </div>
            <div class="stat-card">
                <div class="stat-value neutral-stat" id="total-trades">0</div>
                <div class="stat-label">Total Trades</div>
            </div>
            <div class="stat-card">
                <div class="stat-value neutral-stat" id="win-rate">0%</div>
                <div class="stat-label">Win Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value neutral-stat" id="profit-factor">0.00</div>
                <div class="stat-label">Profit Factor</div>
            </div>
        </div>
        
        <!-- Chart Container -->
        <div class="chart-container">
            <h2 class="chart-title">Account Balance</h2>
            <div class="chart-wrapper">
                <canvas id="balance-chart"></canvas>
            </div>
        </div>
        
        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Calendar Section -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <h2>Calendar</h2>
                    <div class="month-nav">
                        <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                        <div class="month-year" id="current-month">June 2025</div>
                        <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                        <button class="btn btn-secondary today-btn" id="today-btn">Today</button>
                    </div>
                </div>
                <div class="calendar" id="calendar">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Recent Trades / Day Summary Section -->
            <div class="recent-trades" id="right-panel">
                <div class="section-header">
                    <h2 id="right-panel-title">Recent Trades</h2>
                    <a class="view-all" id="view-all-trades">View All</a>
                </div>
                <div id="right-panel-content">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Monthly Summary -->
        <div class="monthly-summary">
            <h2>Summary: <span id="summary-month">June 2025</span></h2>
            <div class="summary-stats">
                <div class="summary-stat">
                    <div class="summary-value" id="monthly-trades">0</div>
                    <div class="summary-label">Total Trades</div>
                </div>
                <div class="summary-stat">
                    <div class="summary-value positive-stat" id="monthly-profit">+$0.00</div>
                    <div class="summary-label">Total P&L</div>
                </div>
                <div class="summary-stat">
                    <div class="summary-value" id="monthly-win-rate">0%</div>
                    <div class="summary-label">Win Rate</div>
                </div>
                <div class="summary-stat">
                    <div class="summary-value" id="monthly-profit-factor">0.00</div>
                    <div class="summary-label">Profit Factor</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Trade Modal -->
    <div class="modal" id="trade-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="trade-modal-title">Add New Trade</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="trade-form">
                <div class="form-group">
                    <label for="pair">Trading Pair</label>
                    <input type="text" id="pair" placeholder="e.g., EUR/USD, BTC/USD" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="type">Type</label>
                        <select id="type" required>
                            <option value="BUY">BUY</option>
                            <option value="SELL">SELL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount Risked ($)</label>
                        <input type="number" id="amount" placeholder="e.g., 100" min="0" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="entry-time">Entry Time</label>
                        <input type="datetime-local" id="entry-time" required>
                    </div>
                    <div class="form-group">
                        <label for="close-time">Close Time</label>
                        <input type="datetime-local" id="close-time">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profit-loss">Profit/Loss ($)</label>
                    <input type="text" id="profit-loss" placeholder="e.g., 50 or -25" pattern="-?[0-9]*\.?[0-9]*" inputmode="decimal">
                    <small style="color: var(--neutral-color);">Use negative numbers for losses</small>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-trade">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Trade</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal" id="close-settings">&times;</button>
            </div>
            
            <div class="settings-section">
                <h3>Appearance</h3>
                <div class="theme-toggle">
                    <label for="dark-mode-toggle">Dark Mode</label>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Account Balance</h3>
                <div class="form-group">
                    <label for="initial-balance">Initial Account Balance ($)</label>
                    <input type="number" id="initial-balance" placeholder="e.g., 5000" min="0" step="0.01">
                </div>
                <button type="button" class="btn btn-primary" id="save-balance">Save Balance</button>
            </div>
            
            <div class="settings-section">
                <h3>Data Management</h3>
                <button type="button" class="btn export-btn" id="export-excel">
                    <i class="fas fa-file-export"></i> Export to Excel
                </button>
                <label for="import-excel" class="file-input-label">
                    <i class="fas fa-file-import"></i> Import from Excel
                </label>
                <input type="file" id="import-excel" class="file-input" accept=".xlsx, .xls">
                <div id="import-status" style="margin-top: 10px; font-size: 14px; color: var(--neutral-color);"></div>
            </div>
        </div>
    </div>
    
    <!-- All Trades Modal -->
    <div class="modal all-trades-modal" id="all-trades-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>All Trades</h2>
                <button class="close-modal" id="close-all-trades">&times;</button>
            </div>
            
            <!-- Bulk Actions -->
            <div class="bulk-actions">
                <button type="button" class="btn btn-secondary" id="select-all-trades">
                    <i class="fas fa-check-square"></i> Select All
                </button>
                <button type="button" class="btn btn-secondary" id="deselect-all-trades">
                    <i class="fas fa-square"></i> Deselect All
                </button>
                <button type="button" class="btn btn-danger" id="delete-selected-trades">
                    <i class="fas fa-trash"></i> Delete Selected
                </button>
                <button type="button" class="btn btn-danger" id="delete-all-trades">
                    <i class="fas fa-trash-alt"></i> Delete All
                </button>
            </div>
            
            <div class="select-all-row">
                <div class="select-all-checkbox">
                    <input type="checkbox" id="select-all-checkbox">
                    <label for="select-all-checkbox">Select All</label>
                </div>
                <div class="selected-count" id="selected-count">0 selected</div>
            </div>
            
            <div class="trades-list" id="all-trades-list">
                <!-- All trades will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // Empty trades array - no default trades
        let trades = [];
        
        // App settings
        let settings = {
            initialBalance: 5000,
            darkMode: false
        };
        
        // Current date tracking
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        
        // Track which trade is being edited
        let editingTradeId = null;
        
        // Chart instance
        let balanceChart = null;
        
        // Currently selected day for summary
        let selectedDay = null;
        
        // Selected trades for bulk operations
        let selectedTradeIds = new Set();
        
        // DOM Elements
        const settingsBtn = document.getElementById('settings-btn');
        const addTradeBtn = document.getElementById('add-trade-btn');
        const calendarEl = document.getElementById('calendar');
        const currentMonthEl = document.getElementById('current-month');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const todayBtn = document.getElementById('today-btn');
        const tradeModal = document.getElementById('trade-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelTradeBtn = document.getElementById('cancel-trade');
        const tradeForm = document.getElementById('trade-form');
        const tradeModalTitle = document.getElementById('trade-modal-title');
        const rightPanel = document.getElementById('right-panel');
        const rightPanelTitle = document.getElementById('right-panel-title');
        const rightPanelContent = document.getElementById('right-panel-content');
        const viewAllTradesBtn = document.getElementById('view-all-trades');
        const totalProfitEl = document.getElementById('total-profit');
        const winRateEl = document.getElementById('win-rate');
        const totalTradesEl = document.getElementById('total-trades');
        const profitFactorEl = document.getElementById('profit-factor');
        const monthlyProfitEl = document.getElementById('monthly-profit');
        const monthlyTradesEl = document.getElementById('monthly-trades');
        const monthlyWinRateEl = document.getElementById('monthly-win-rate');
        const monthlyProfitFactorEl = document.getElementById('monthly-profit-factor');
        const summaryMonthEl = document.getElementById('summary-month');
        const balanceChartCanvas = document.getElementById('balance-chart');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const initialBalanceInput = document.getElementById('initial-balance');
        const saveBalanceBtn = document.getElementById('save-balance');
        const exportExcelBtn = document.getElementById('export-excel');
        const importExcelInput = document.getElementById('import-excel');
        const importStatus = document.getElementById('import-status');
        const allTradesModal = document.getElementById('all-trades-modal');
        const closeAllTradesBtn = document.getElementById('close-all-trades');
        const allTradesList = document.getElementById('all-trades-list');
        const selectAllTradesBtn = document.getElementById('select-all-trades');
        const deselectAllTradesBtn = document.getElementById('deselect-all-trades');
        const deleteSelectedTradesBtn = document.getElementById('delete-selected-trades');
        const deleteAllTradesBtn = document.getElementById('delete-all-trades');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const selectedCountEl = document.getElementById('selected-count');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
            updateStats();
            renderRecentTrades();
            updateBalanceChart();
            updateMonthlySummary();
            
            // Load settings from localStorage
            const savedSettings = localStorage.getItem('tradeTrackerSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                darkModeToggle.checked = settings.darkMode;
                initialBalanceInput.value = settings.initialBalance;
                if (settings.darkMode) {
                    document.body.classList.add('dark-mode');
                }
                updateStats();
            }
            
            // Load trades from localStorage
            const savedTrades = localStorage.getItem('tradeTrackerTrades');
            if (savedTrades) {
                trades = JSON.parse(savedTrades);
                renderCalendar();
                updateStats();
                renderRecentTrades();
                updateBalanceChart();
                updateMonthlySummary();
            }
            
            // Event listeners
            settingsBtn.addEventListener('click', openSettingsModal);
            addTradeBtn.addEventListener('click', openAddTradeModal);
            prevMonthBtn.addEventListener('click', goToPreviousMonth);
            nextMonthBtn.addEventListener('click', goToNextMonth);
            todayBtn.addEventListener('click', goToToday);
            closeModalBtn.addEventListener('click', closeModal);
            cancelTradeBtn.addEventListener('click', closeModal);
            tradeForm.addEventListener('submit', saveTrade);
            viewAllTradesBtn.addEventListener('click', openAllTradesModal);
            closeSettingsBtn.addEventListener('click', closeSettingsModal);
            darkModeToggle.addEventListener('change', toggleDarkMode);
            saveBalanceBtn.addEventListener('click', saveBalance);
            exportExcelBtn.addEventListener('click', exportToExcel);
            importExcelInput.addEventListener('change', importFromExcel);
            closeAllTradesBtn.addEventListener('click', closeAllTradesModal);
            
            // Bulk actions event listeners
            selectAllTradesBtn.addEventListener('click', selectAllTrades);
            deselectAllTradesBtn.addEventListener('click', deselectAllTrades);
            deleteSelectedTradesBtn.addEventListener('click', deleteSelectedTrades);
            deleteAllTradesBtn.addEventListener('click', deleteAllTrades);
            selectAllCheckbox.addEventListener('change', toggleSelectAll);
        });
        
        // Calendar functions
        function renderCalendar() {
            // Clear the calendar
            calendarEl.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day;
                calendarEl.appendChild(dayHeader);
            });
            
            // Update month/year display
            const monthYear = `${getMonthName(currentMonth)} ${currentYear}`;
            currentMonthEl.textContent = monthYear;
            summaryMonthEl.textContent = monthYear;
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Get previous month's last days
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            
            // Add previous month's days
            for (let i = firstDay - 1; i >= 0; i--) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day prev-month-day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = prevMonthLastDay - i;
                dayEl.appendChild(dayNumber);
                
                calendarEl.appendChild(dayEl);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayEl.appendChild(dayNumber);
                
                // Format date for this day
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Calculate daily P&L (only for closed trades)
                const dailyTrades = getTradesForDay(dateStr);
                const closedTrades = dailyTrades.filter(trade => trade.status === 'closed');
                const dailyProfitLoss = closedTrades.reduce((sum, trade) => sum + trade.profitLoss, 0);
                
                if (closedTrades.length > 0) {
                    const pnlEl = document.createElement('div');
                    pnlEl.className = dailyProfitLoss >= 0 ? 'profit' : 'loss';
                    pnlEl.textContent = dailyProfitLoss >= 0 ? `+$${dailyProfitLoss.toFixed(2)}` : `-$${Math.abs(dailyProfitLoss).toFixed(2)}`;
                    dayEl.appendChild(pnlEl);
                }
                
                // Add trade count badge if there are trades
                if (dailyTrades.length > 0) {
                    const tradeCount = document.createElement('div');
                    tradeCount.className = 'trade-count';
                    tradeCount.textContent = `${dailyTrades.length} trade${dailyTrades.length > 1 ? 's' : ''}`;
                    dayEl.appendChild(tradeCount);
                }
                
                // Click on day to show summary
                dayEl.addEventListener('click', function() {
                    showDaySummary(dateStr, day);
                });
                
                calendarEl.appendChild(dayEl);
            }
            
            // Calculate remaining cells for next month
            const totalCells = 42; // 6 rows x 7 days
            const cellsUsed = firstDay + daysInMonth;
            const nextMonthDays = totalCells - cellsUsed;
            
            // Add next month's first days
            for (let day = 1; day <= nextMonthDays; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day prev-month-day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayEl.appendChild(dayNumber);
                
                calendarEl.appendChild(dayEl);
            }
        }
        
        function getTradesForDay(dateStr) {
            return trades.filter(trade => {
                if (trade.status === 'open') {
                    return trade.date === dateStr;
                } else {
                    const closeDate = trade.closeTime ? trade.closeTime.split('T')[0] : null;
                    return closeDate === dateStr;
                }
            });
        }
        
        function showDaySummary(dateStr, day) {
            selectedDay = dateStr;
            const dailyTrades = getTradesForDay(dateStr);
            const closedTrades = dailyTrades.filter(trade => trade.status === 'closed');
            const dailyProfitLoss = closedTrades.reduce((sum, trade) => sum + trade.profitLoss, 0);
            const winningTrades = closedTrades.filter(trade => trade.profitLoss > 0).length;
            const winRate = closedTrades.length > 0 ? Math.round((winningTrades / closedTrades.length) * 100) : 0;
            
            const dateObj = new Date(dateStr);
            const monthName = getMonthName(dateObj.getMonth());
            
            rightPanelTitle.textContent = `Summary: ${monthName} ${day}`;
            rightPanelContent.innerHTML = `
                <div class="day-summary">
                    <div class="day-summary-stats">
                        <div class="day-summary-stat">
                            <div class="day-summary-value ${dailyProfitLoss >= 0 ? 'positive-stat' : 'negative-stat'}">
                                ${dailyProfitLoss >= 0 ? '+' : ''}$${dailyProfitLoss.toFixed(2)}
                            </div>
                            <div class="day-summary-label">Daily P&L</div>
                        </div>
                        <div class="day-summary-stat">
                            <div class="day-summary-value">${dailyTrades.length}</div>
                            <div class="day-summary-label">Total Trades</div>
                        </div>
                        <div class="day-summary-stat">
                            <div class="day-summary-value">${winRate}%</div>
                            <div class="day-summary-label">Win Rate</div>
                        </div>
                        <div class="day-summary-stat">
                            <div class="day-summary-value">${closedTrades.length}</div>
                            <div class="day-summary-label">Closed Trades</div>
                        </div>
                    </div>
                    <div class="day-trades-list">
                        ${dailyTrades.length > 0 ? 
                            dailyTrades.map(trade => `
                                <div class="trade-item">
                                    <div class="trade-info">
                                        <div class="trade-pair">${trade.pair}</div>
                                        <div class="trade-date">${formatTime(trade.entryTime)}</div>
                                    </div>
                                    <div class="trade-profit ${trade.status === 'closed' ? (trade.profitLoss >= 0 ? 'positive' : 'negative') : ''}">
                                        ${trade.status === 'open' ? 'Open' : (trade.profitLoss >= 0 ? '+' : '') + '$' + trade.profitLoss.toFixed(2)}
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="text-align: center; color: var(--neutral-color); padding: 20px;">No trades for this day</p>'
                        }
                    </div>
                </div>
            `;
        }
        
        function goToPreviousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
            updateMonthlySummary();
            // Reset to recent trades view when changing months
            showRecentTrades();
        }
        
        function goToNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
            updateMonthlySummary();
            // Reset to recent trades view when changing months
            showRecentTrades();
        }
        
        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
            updateMonthlySummary();
            showRecentTrades();
        }
        
        function getMonthName(monthIndex) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[monthIndex];
        }
        
        // Modal functions
        function openAddTradeModal() {
            editingTradeId = null;
            tradeModalTitle.textContent = 'Add New Trade';
            tradeForm.reset();
            
            // Set default date to today
            const today = new Date();
            const formatForInput = (date) => {
                return date.toISOString().slice(0, 16);
            };
            
            document.getElementById('entry-time').value = formatForInput(today);
            
            tradeModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function openEditTradeModal(tradeId) {
            editingTradeId = tradeId;
            const trade = trades.find(t => t.id === tradeId);
            
            if (!trade) return;
            
            tradeModalTitle.textContent = 'Edit Trade';
            tradeForm.reset();
            
            document.getElementById('pair').value = trade.pair;
            document.getElementById('type').value = trade.type;
            document.getElementById('amount').value = trade.amount;
            document.getElementById('entry-time').value = trade.entryTime;
            
            if (trade.closeTime) {
                document.getElementById('close-time').value = trade.closeTime;
            }
            
            if (trade.profitLoss !== null) {
                document.getElementById('profit-loss').value = trade.profitLoss;
            }
            
            tradeModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal() {
            tradeModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function closeSettingsModal() {
            settingsModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function closeAllTradesModal() {
            allTradesModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function saveTrade(e) {
            e.preventDefault();
            
            const pair = document.getElementById('pair').value;
            const type = document.getElementById('type').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const entryTime = document.getElementById('entry-time').value;
            const closeTime = document.getElementById('close-time').value;
            
            // Parse profit/loss as float to handle negative numbers
            const profitLossValue = document.getElementById('profit-loss').value;
            const profitLoss = profitLossValue ? parseFloat(profitLossValue) : null;
            
            // Extract date from entry time
            const entryDate = entryTime.split('T')[0];
            
            // Determine trade status
            const status = closeTime && profitLoss !== null ? 'closed' : 'open';
            
            // For closed trades, use close date for calendar display
            // For open trades, use entry date
            const displayDate = status === 'closed' && closeTime ? closeTime.split('T')[0] : entryDate;
            
            if (editingTradeId) {
                // Update existing trade
                const tradeIndex = trades.findIndex(t => t.id === editingTradeId);
                if (tradeIndex !== -1) {
                    trades[tradeIndex] = {
                        ...trades[tradeIndex],
                        pair,
                        type,
                        amount,
                        entryTime,
                        closeTime,
                        profitLoss,
                        date: displayDate,
                        entryDate: entryDate,
                        status
                    };
                }
            } else {
                // Create new trade object
                const newTrade = {
                    id: trades.length > 0 ? Math.max(...trades.map(t => t.id)) + 1 : 1,
                    pair,
                    type,
                    amount,
                    entryTime,
                    closeTime,
                    profitLoss,
                    date: displayDate,
                    entryDate: entryDate,
                    status
                };
                
                // Add to trades array
                trades.push(newTrade);
            }
            
            // Save to localStorage
            localStorage.setItem('tradeTrackerTrades', JSON.stringify(trades));
            
            // Update UI
            renderCalendar();
            updateStats();
            renderRecentTrades();
            updateBalanceChart();
            updateMonthlySummary();
            
            // If a day is selected, update its summary
            if (selectedDay) {
                const day = new Date(selectedDay).getDate();
                showDaySummary(selectedDay, day);
            }
            
            // Close modal
            closeModal();
        }
        
        function deleteTrade(tradeId) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(trade => trade.id !== tradeId);
                
                // Save to localStorage
                localStorage.setItem('tradeTrackerTrades', JSON.stringify(trades));
                
                // Update UI
                renderCalendar();
                updateStats();
                renderRecentTrades();
                updateBalanceChart();
                updateMonthlySummary();
                renderAllTradesList();
                
                // If a day is selected, update its summary
                if (selectedDay) {
                    const day = new Date(selectedDay).getDate();
                    showDaySummary(selectedDay, day);
                }
            }
        }
        
        // Stats functions
        function updateStats() {
            const closedTrades = trades.filter(trade => trade.status === 'closed');
            const totalProfit = closedTrades.reduce((sum, trade) => sum + trade.profitLoss, 0);
            const winningTrades = closedTrades.filter(trade => trade.profitLoss > 0).length;
            const winRate = closedTrades.length > 0 ? Math.round((winningTrades / closedTrades.length) * 100) : 0;
            
            // Calculate profit factor
            const totalWins = closedTrades.filter(t => t.profitLoss > 0).reduce((sum, t) => sum + t.profitLoss, 0);
            const totalLosses = Math.abs(closedTrades.filter(t => t.profitLoss < 0).reduce((sum, t) => sum + t.profitLoss, 0));
            const profitFactor = totalLosses > 0 ? (totalWins / totalLosses).toFixed(2) : totalWins > 0 ? '' : '0.00';
            
            totalProfitEl.textContent = `${totalProfit >= 0 ? '+' : ''}$${totalProfit.toFixed(2)}`;
            totalProfitEl.className = `stat-value ${totalProfit >= 0 ? 'positive-stat' : 'negative-stat'}`;
            
            winRateEl.textContent = `${winRate}%`;
            totalTradesEl.textContent = trades.length;
            profitFactorEl.textContent = profitFactor;
        }
        
        // Recent trades functions
        function showRecentTrades() {
            rightPanelTitle.textContent = 'Recent Trades';
            renderRecentTrades();
        }
        
        function renderRecentTrades() {
            rightPanelContent.innerHTML = '';
            
            if (trades.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'trade-item';
                emptyState.innerHTML = `
                    <div class="trade-info">
                        <div class="trade-pair">No trades yet</div>
                    </div>
                `;
                rightPanelContent.appendChild(emptyState);
                return;
            }
            
            // Sort trades by date (newest first) and take the 5 most recent
            const sortedTrades = [...trades].sort((a, b) => {
                const dateA = a.status === 'closed' && a.closeTime ? new Date(a.closeTime) : new Date(a.entryTime);
                const dateB = b.status === 'closed' && b.closeTime ? new Date(b.closeTime) : new Date(b.entryTime);
                return dateB - dateA;
            }).slice(0, 5);
            
            sortedTrades.forEach(trade => {
                const tradeEl = document.createElement('div');
                tradeEl.className = 'trade-item';
                
                const profitLossDisplay = trade.status === 'open' ? 
                    'Open' : 
                    `${trade.profitLoss >= 0 ? '+' : ''}$${trade.profitLoss.toFixed(2)}`;
                
                const tradeDate = trade.status === 'closed' && trade.closeTime ? 
                    new Date(trade.closeTime) : new Date(trade.entryTime);
                const formattedDate = `${tradeDate.getMonth() + 1}/${tradeDate.getDate()}/${tradeDate.getFullYear()}`;
                
                tradeEl.innerHTML = `
                    <div class="trade-info">
                        <div class="trade-pair">${trade.pair}</div>
                        <div class="trade-date">${formattedDate}</div>
                    </div>
                    <div class="trade-profit ${trade.status === 'closed' ? (trade.profitLoss >= 0 ? 'positive' : 'negative') : ''}">
                        ${profitLossDisplay}
                    </div>
                `;
                
                rightPanelContent.appendChild(tradeEl);
            });
        }
        
        // All trades functions
        function openAllTradesModal() {
            renderAllTradesList();
            allTradesModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function renderAllTradesList() {
            allTradesList.innerHTML = '';
            selectedTradeIds.clear();
            updateSelectedCount();
            
            if (trades.length === 0) {
                allTradesList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--neutral-color);">No trades recorded yet.</p>';
                return;
            }
            
            // Sort trades by date (newest first)
            const sortedTrades = [...trades].sort((a, b) => {
                const dateA = a.status === 'closed' && a.closeTime ? new Date(a.closeTime) : new Date(a.entryTime);
                const dateB = b.status === 'closed' && b.closeTime ? new Date(b.closeTime) : new Date(b.entryTime);
                return dateB - dateA;
            });
            
            sortedTrades.forEach(trade => {
                const tradeEl = document.createElement('div');
                tradeEl.className = 'trade-management-item';
                
                const tradeDate = trade.status === 'closed' && trade.closeTime ? 
                    new Date(trade.closeTime) : new Date(trade.entryTime);
                const formattedDate = `${tradeDate.getMonth() + 1}/${tradeDate.getDate()}/${tradeDate.getFullYear()}`;
                
                tradeEl.innerHTML = `
                    <div class="trade-management-info">
                        <input type="checkbox" class="trade-checkbox" value="${trade.id}">
                        <div class="trade-management-pair">${trade.pair}</div>
                        <div class="trade-management-type ${trade.type.toLowerCase()}">${trade.type}</div>
                        <div class="trade-management-date">${formattedDate}</div>
                        <div class="trade-management-amount">$${trade.amount.toFixed(2)}</div>
                        <div class="trade-profit ${trade.status === 'closed' ? (trade.profitLoss >= 0 ? 'positive' : 'negative') : ''}">
                            ${trade.status === 'open' ? 'Open' : (trade.profitLoss >= 0 ? '+' : '') + '$' + trade.profitLoss.toFixed(2)}
                        </div>
                    </div>
                    <div class="trade-management-actions">
                        <button class="action-btn edit-btn" data-id="${trade.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete-btn" data-id="${trade.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                allTradesList.appendChild(tradeEl);
            });
            
            // Add event listeners to checkboxes
            allTradesList.querySelectorAll('.trade-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const tradeId = parseInt(this.value);
                    if (this.checked) {
                        selectedTradeIds.add(tradeId);
                    } else {
                        selectedTradeIds.delete(tradeId);
                    }
                    updateSelectedCount();
                    updateSelectAllCheckbox();
                });
            });
            
            // Add event listeners to edit and delete buttons
            allTradesList.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tradeId = parseInt(this.getAttribute('data-id'));
                    closeAllTradesModal();
                    openEditTradeModal(tradeId);
                });
            });
            
            allTradesList.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tradeId = parseInt(this.getAttribute('data-id'));
                    deleteTrade(tradeId);
                });
            });
        }
        
        // Bulk selection functions
        function selectAllTrades() {
            selectedTradeIds.clear();
            trades.forEach(trade => {
                selectedTradeIds.add(trade.id);
            });
            updateSelectedCount();
            updateCheckboxes();
        }
        
        function deselectAllTrades() {
            selectedTradeIds.clear();
            updateSelectedCount();
            updateCheckboxes();
        }
        
        function deleteSelectedTrades() {
            if (selectedTradeIds.size === 0) {
                alert('Please select at least one trade to delete.');
                return;
            }
            
            // Offer backup option
            const backupChoice = confirm(`You are about to delete ${selectedTradeIds.size} trade(s). Would you like to create a backup first? Click OK to create a backup, or Cancel to delete without backup.`);
            
            if (backupChoice) {
                exportToExcel();
            }
            
            if (confirm(`Are you sure you want to delete ${selectedTradeIds.size} selected trade(s)? This action cannot be undone.`)) {
                trades = trades.filter(trade => !selectedTradeIds.has(trade.id));
                
                // Save to localStorage
                localStorage.setItem('tradeTrackerTrades', JSON.stringify(trades));
                
                // Clear selection
                selectedTradeIds.clear();
                updateSelectedCount();
                
                // Update UI
                renderCalendar();
                updateStats();
                renderRecentTrades();
                updateBalanceChart();
                updateMonthlySummary();
                renderAllTradesList();
                
                alert(`Successfully deleted ${selectedTradeIds.size} trade(s).`);
            }
        }
        
        function deleteAllTrades() {
            if (trades.length === 0) {
                alert('No trades to delete.');
                return;
            }
            
            // Offer backup option
            const backupChoice = confirm(`You are about to delete ALL ${trades.length} trades. Would you like to create a backup first? Click OK to create a backup, or Cancel to delete without backup.`);
            
            if (backupChoice) {
                exportToExcel();
            }
            
            if (confirm(`Are you sure you want to delete ALL ${trades.length} trades? This action cannot be undone.`)) {
                trades = [];
                
                // Save to localStorage
                localStorage.setItem('tradeTrackerTrades', JSON.stringify(trades));
                
                // Clear selection
                selectedTradeIds.clear();
                updateSelectedCount();
                
                // Update UI
                renderCalendar();
                updateStats();
                renderRecentTrades();
                updateBalanceChart();
                updateMonthlySummary();
                renderAllTradesList();
                
                alert('All trades have been deleted.');
            }
        }
        
        function toggleSelectAll() {
            if (selectAllCheckbox.checked) {
                selectAllTrades();
            } else {
                deselectAllTrades();
            }
        }
        
        function updateSelectedCount() {
            selectedCountEl.textContent = `${selectedTradeIds.size} selected`;
        }
        
        function updateCheckboxes() {
            const checkboxes = allTradesList.querySelectorAll('.trade-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectedTradeIds.has(parseInt(checkbox.value));
            });
            updateSelectAllCheckbox();
        }
        
        function updateSelectAllCheckbox() {
            const allSelected = trades.length > 0 && selectedTradeIds.size === trades.length;
            const someSelected = selectedTradeIds.size > 0 && selectedTradeIds.size < trades.length;
            
            selectAllCheckbox.checked = allSelected;
            selectAllCheckbox.indeterminate = someSelected;
        }
        
        // Monthly summary functions
        function updateMonthlySummary() {
            // Get trades for the current month
            const monthTrades = trades.filter(trade => {
                const tradeDate = new Date(trade.status === 'closed' && trade.closeTime ? trade.closeTime : trade.entryTime);
                return tradeDate.getMonth() === currentMonth && tradeDate.getFullYear() === currentYear;
            });
            
            const closedMonthTrades = monthTrades.filter(trade => trade.status === 'closed');
            const monthlyProfit = closedMonthTrades.reduce((sum, trade) => sum + trade.profitLoss, 0);
            const winningMonthTrades = closedMonthTrades.filter(trade => trade.profitLoss > 0).length;
            const monthlyWinRate = closedMonthTrades.length > 0 ? Math.round((winningMonthTrades / closedMonthTrades.length) * 100) : 0;
            
            // Calculate monthly profit factor
            const monthlyWins = closedMonthTrades.filter(t => t.profitLoss > 0).reduce((sum, t) => sum + t.profitLoss, 0);
            const monthlyLosses = Math.abs(closedMonthTrades.filter(t => t.profitLoss < 0).reduce((sum, t) => sum + t.profitLoss, 0));
            const monthlyProfitFactor = monthlyLosses > 0 ? (monthlyWins / monthlyLosses).toFixed(2) : monthlyWins > 0 ? '' : '0.00';
            
            monthlyProfitEl.textContent = `${monthlyProfit >= 0 ? '+' : ''}$${monthlyProfit.toFixed(2)}`;
            monthlyProfitEl.className = `summary-value ${monthlyProfit >= 0 ? 'positive-stat' : 'negative-stat'}`;
            
            monthlyTradesEl.textContent = monthTrades.length;
            monthlyWinRateEl.textContent = `${monthlyWinRate}%`;
            monthlyProfitFactorEl.textContent = monthlyProfitFactor;
        }
        
        function updateBalanceChart() {
            // Prepare data for the chart
            const closedTrades = trades.filter(trade => trade.status === 'closed')
                .sort((a, b) => new Date(a.closeTime || a.entryTime) - new Date(b.closeTime || b.entryTime));
            
            let balanceData = [settings.initialBalance];
            let labels = ['Initial'];
            
            let runningBalance = settings.initialBalance;
            
            closedTrades.forEach(trade => {
                runningBalance += trade.profitLoss;
                balanceData.push(runningBalance);
                const tradeDate = trade.closeTime ? new Date(trade.closeTime) : new Date(trade.entryTime);
                const monthName = getMonthName(tradeDate.getMonth()).substring(0, 3);
                const day = tradeDate.getDate();
                labels.push(`${monthName} ${day}`);
            });
            
            // Get chart colors based on theme
            const textColor = getComputedStyle(document.body).getPropertyValue('--text-color');
            const gridColor = getComputedStyle(document.body).getPropertyValue('--border-color');
            const profitColor = getComputedStyle(document.body).getPropertyValue('--profit-color');
            
            // Destroy existing chart if it exists
            if (balanceChart) {
                balanceChart.destroy();
            }
            
            // Create new chart
            const ctx = balanceChartCanvas.getContext('2d');
            balanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Account Balance',
                        data: balanceData,
                        borderColor: profitColor,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: profitColor,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: profitColor,
                            borderWidth: 1,
                            cornerRadius: 6,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `Balance: $${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: textColor,
                                maxTicksLimit: window.innerWidth < 768 ? 5 : 8,
                                font: {
                                    size: window.innerWidth < 768 ? 10 : 12
                                }
                            },
                            grid: {
                                color: gridColor,
                                drawBorder: false
                            }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                color: textColor,
                                font: {
                                    size: window.innerWidth < 768 ? 10 : 12
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: gridColor,
                                drawBorder: false
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
        
        // Settings functions
        function openSettingsModal() {
            settingsModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function toggleDarkMode() {
            settings.darkMode = darkModeToggle.checked;
            localStorage.setItem('tradeTrackerSettings', JSON.stringify(settings));
            
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            
            // Update chart colors for dark mode
            updateBalanceChart();
        }
        
        function saveBalance() {
            const balance = parseFloat(initialBalanceInput.value);
            if (!isNaN(balance) && balance >= 0) {
                settings.initialBalance = balance;
                localStorage.setItem('tradeTrackerSettings', JSON.stringify(settings));
                updateStats();
                updateBalanceChart();
                alert('Initial balance updated successfully!');
            } else {
                alert('Please enter a valid balance amount.');
            }
        }
        
        function exportToExcel() {
            if (trades.length === 0) {
                alert('No trades to export.');
                return;
            }
            
            // Prepare data for export
            const exportData = trades.map(trade => ({
                'Trade ID': trade.id,
                'Pair': trade.pair,
                'Type': trade.type,
                'Amount Risked': trade.amount,
                'Entry Time': trade.entryTime,
                'Close Time': trade.closeTime || 'Open',
                'Profit/Loss': trade.profitLoss || 'Open',
                'Status': trade.status,
                'Entry Date': trade.entryDate,
                'Display Date': trade.date
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Trades');
            
            // Generate Excel file and trigger download
            const fileName = `TradeJournal_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }
        
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            importStatus.textContent = 'Importing...';
            importStatus.style.color = 'var(--neutral-color)';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first worksheet
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        importStatus.textContent = 'No data found in file.';
                        importStatus.style.color = 'var(--loss-color)';
                        return;
                    }
                    
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    jsonData.forEach(row => {
                        // Validate required fields
                        if (!row.Pair || !row.Type || row['Amount Risked'] === undefined) {
                            skippedCount++;
                            return;
                        }
                        
                        // Determine if trade is closed or open
                        const hasCloseTime = row['Close Time'] && row['Close Time'] !== 'Open';
                        const hasProfitLoss = row['Profit/Loss'] !== undefined && row['Profit/Loss'] !== 'Open';
                        const status = hasCloseTime && hasProfitLoss ? 'closed' : 'open';
                        
                        // Use display date if available, otherwise use close date or entry date
                        let displayDate;
                        if (row['Display Date']) {
                            displayDate = row['Display Date'];
                        } else if (hasCloseTime) {
                            displayDate = new Date(row['Close Time']).toISOString().split('T')[0];
                        } else {
                            displayDate = new Date(row['Entry Time']).toISOString().split('T')[0];
                        }
                        
                        const trade = {
                            id: trades.length > 0 ? Math.max(...trades.map(t => t.id)) + 1 : 1,
                            pair: row.Pair,
                            type: row.Type,
                            amount: parseFloat(row['Amount Risked']),
                            entryTime: row['Entry Time'],
                            closeTime: hasCloseTime ? row['Close Time'] : '',
                            profitLoss: hasProfitLoss ? parseFloat(row['Profit/Loss']) : null,
                            date: displayDate,
                            entryDate: new Date(row['Entry Time']).toISOString().split('T')[0],
                            status: status
                        };
                        
                        trades.push(trade);
                        importedCount++;
                    });
                    
                    // Save to localStorage
                    localStorage.setItem('tradeTrackerTrades', JSON.stringify(trades));
                    
                    // Update UI
                    renderCalendar();
                    updateStats();
                    renderRecentTrades();
                    updateBalanceChart();
                    updateMonthlySummary();
                    
                    importStatus.textContent = `Successfully imported ${importedCount} trades. ${skippedCount} rows skipped.`;
                    importStatus.style.color = 'var(--profit-color)';
                    
                    // Reset file input
                    importExcelInput.value = '';
                    
                } catch (error) {
                    console.error('Import error:', error);
                    importStatus.textContent = 'Error importing file. Please check the format.';
                    importStatus.style.color = 'var(--loss-color)';
                }
            };
            
            reader.onerror = function() {
                importStatus.textContent = 'Error reading file.';
                importStatus.style.color = 'var(--loss-color)';
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Utility functions
        function formatTime(dateTimeStr) {
            if (!dateTimeStr) return '';
            const date = new Date(dateTimeStr);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Close modals when clicking outside of them
        window.addEventListener('click', function(e) {
            if (e.target === tradeModal) {
                closeModal();
            }
            if (e.target === settingsModal) {
                closeSettingsModal();
            }
            if (e.target === allTradesModal) {
                closeAllTradesModal();
            }
        });
        
        // Initialize with recent trades view
        showRecentTrades();
    </script>
</body>
</html>
